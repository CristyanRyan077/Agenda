<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:vm="clr-namespace:AgendaNovo.ViewModels"
            xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    x:Class="AgendaNovo.GerenciarClientes"
    mc:Ignorable="d"
    WindowState="Maximized"
    Title="GerenciarClientes"
    d:DesignWidth="1366"
    d:DesignHeight="768"
    MinWidth="1000" MinHeight="600"
    d:DataContext="{d:DesignInstance Type=vm:ClienteCriancaViewModel}">
    <Window.Background>
        <LinearGradientBrush>
            <GradientStop Color="#7be9f6" Offset="0.1"/>
            <GradientStop Color="#f093da" Offset="1"/>
        </LinearGradientBrush>
    </Window.Background>

    <Grid Margin="15">


        <!-- Layout principal -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Aviso -->
            <RowDefinition Height="Auto"/>
            <!-- Formulário -->
            <RowDefinition Height="Auto"/>
            <!-- Botões -->
            <RowDefinition Height="Auto"/>
            <!-- Pesquisa -->
            <RowDefinition Height="*"/>
            <!-- DataGrid -->
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- Aviso -->
        <TextBlock Text="⚠️ Cliente já existente detectado &#10;Uma nova criança será adicionada."
                   Foreground="Orange" FontSize="12" HorizontalAlignment="Center"
                   FontWeight="Bold" Background="Black" Padding="6"
                   Visibility="{Binding ClienteExistenteDetectado, Converter={StaticResource BoolToVisibilityConverter}}"
                   Grid.ColumnSpan="2" Margin="0,0,0,10"/>

        <!-- Card Cliente -->
        <materialDesign:Card Grid.Row="1" Grid.Column="0" Margin="5" Width="500" HorizontalAlignment="Left" Padding="15" Background="#FF7BE9F6">
            <StackPanel>
                <TextBlock Text="Cliente" FontWeight="Bold" FontSize="14" Foreground="#444" Margin="0,0,0,8"/>

                <hc:TextBox Name="txtCliente" Padding="10" Background="White" Foreground="Black"
                         hc:InfoElement.Placeholder="Nome do Cliente" SelectionBrush="Black"
                         Text="{Binding NovoCliente.Nome, Mode=TwoWay}"
                         Margin="0,4" BorderBrush="Black"/>

                <hc:TextBox  SelectionTextBrush="Black" hc:InfoElement.Placeholder="Telefone"
                         LostFocus="txtTel_LostFocus" Background="White" Padding="10"
                         Text="{Binding NovoCliente.Telefone, Mode=TwoWay}"
                          Margin="0,4" BorderBrush="Black"/>

                <hc:TextBox materialDesign:HintAssist.Hint="Email" Background="White"
                          LostFocus="txtEmail_LostFocus"    Padding="10" hc:InfoElement.Placeholder="Email"
                         Text="{Binding NovoCliente.Email, Mode=TwoWay}"
                         Margin="0,4" BorderBrush="Black"/>

                <hc:TextBox hc:InfoElement.Placeholder="Instagram" materialDesign:HintAssist.Hint="Instagram"
                         Height="32"    Padding="8" Background="White"
                         Text="{Binding NovoCliente.Instagram, Mode=TwoWay}"
                          Margin="0,4" BorderBrush="Black"/>

                <hc:TextBox hc:InfoElement.Placeholder="Facebook"
                         Height="32"    Padding="8" Background="White"
                         Text="{Binding NovoCliente.Facebook, Mode=TwoWay}"
                          Margin="0,4" BorderBrush="Black"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Card Criança -->
        <materialDesign:Card Grid.Row="1" Grid.Column="1" Margin="5" Width="400" HorizontalAlignment="Left" Padding="15" Background="#FFC0B6E5">
            <StackPanel>
                <TextBlock Text="Criança" FontWeight="Bold"
                           FontSize="14" Foreground="#444" Margin="0,0,0,8"/>

                <hc:TextBox Name="txtCrianca" Width="300" HorizontalAlignment="Left"
                              hc:InfoElement.Placeholder="Criança"
                              Padding="8" Background="White"
                              SelectionBrush="Black"
                          Text="{Binding CriancaSelecionada.Nome, Mode=TwoWay}"
                           Margin="0,4" BorderBrush="Black"/>

                <hc:ComboBox materialDesign:HintAssist.Hint="Gênero"
                              Padding="8" Background="White" Width="200" hc:InfoElement.Placeholder="Gênero"
                          ItemsSource="{Binding GenerosLista}" HorizontalAlignment="Left"
                          Text="{Binding CriancaSelecionada.Genero}" BorderBrush="Black"
                          Margin="0,4"/>

                <StackPanel Orientation="Horizontal" Margin="0,4">
                    <hc:TextBox hc:InfoElement.Placeholder="Idade" BorderBrush="Black"
                               Padding="4" Width="80" Background="White"
                             Text="{Binding CriancaSelecionada.Idade, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,8,0"/>
                    <hc:ComboBox hc:InfoElement.Placeholder="Anos/meses" BorderBrush="Black"
                                Padding="8" Width="110" Background="White"
                              ItemsSource="{Binding IdadesUnidadeDisponiveis}"
                              SelectedItem="{Binding CriancaSelecionada.IdadeUnidade, UpdateSourceTrigger=PropertyChanged}"
                              />
                </StackPanel>

                <DatePicker materialDesign:HintAssist.Hint="Nascimento" BorderBrush="Black" BorderThickness="1"
                             Padding="10" Width="200" HorizontalAlignment="Left"  hc:InfoElement.Placeholder="Nascimento"
                            SelectedDate="{Binding CriancaSelecionada.NascimentoDateTime, Mode=TwoWay}"
                            Margin="0,4"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Botões -->
        <StackPanel Grid.Row="2" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,12,90,0">
            <Button Content="Salvar" Command="{Binding SalvarClienteCriancaCommand}"
                    Style="{DynamicResource MaterialDesignContainedButton}"
                    Background="ForestGreen" Foreground="White"
                    Width="120" Height="34" Margin="6"/>
            <Button Content="Editar" Command="{Binding EditarClienteCriancaSelecionadoCommand}"
                    Style="{DynamicResource MaterialDesignContainedButton}"
                    Background="DeepSkyBlue" Foreground="White"
                    Width="120" Height="34" Margin="6"/>
            <Button Content="Excluir" Command="{Binding ExcluirClienteOuCriancaSelecionadoCommand}"
                    Style="{DynamicResource MaterialDesignContainedButton}"
                    Background="Red" Foreground="White"
                    Width="120" Height="34" Margin="6"/>
        </StackPanel>

        <!-- Pesquisa -->
        <StackPanel Grid.Row="3" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10">
            <hc:TextBox hc:InfoElement.Placeholder="Buscar por nome"
                     Height="32" Width="350" Background="White" HorizontalAlignment="Right"
                     Text="{Binding PesquisaText, UpdateSourceTrigger=PropertyChanged}" BorderBrush="Black"
                     />
            <materialDesign:PackIcon Kind="Search" Width="26" Height="26" Margin="8,0,0,0" VerticalAlignment="Center"/>
        </StackPanel>

        <!-- DataGrid -->
        <DataGrid Grid.Row="4" Grid.ColumnSpan="2"
                  ItemsSource="{Binding ListaClienteCrianca}"
                  SelectedItem="{Binding ClienteCriancaSelecionado, Mode=TwoWay}"
                  AutoGenerateColumns="False"
                   Margin="5"
                  FontSize="13">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding ClienteId}"/>
                <DataGridTextColumn Header="Cliente" Binding="{Binding NomeCliente}" />
                <DataGridTextColumn Header="Telefone" Binding="{Binding Telefone}"/>
                <DataGridTextColumn Header="Email" Binding="{Binding Email }"/>
                <DataGridTextColumn Header="Criança" Binding="{Binding NomeCrianca}"/>
                <DataGridTextColumn Header="Idade" Binding="{Binding IdadeFormatada}" />
                <DataGridTextColumn Header="Gênero" Binding="{Binding Genero}" />
                <DataGridTextColumn Header="Nascimento" Binding="{Binding Nascimento, StringFormat=dd/MM/yyyy}" />
                <DataGridTextColumn Header="Status" Binding="{Binding Status}" >
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Status}" Value="Pendente">
                                    <Setter Property="Foreground" Value="Red"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Ativo">
                                    <Setter Property="Foreground" Value="Green"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="Inativo">
                                    <Setter Property="Foreground" Value="Orange"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Window>
