<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:vm="clr-namespace:AgendaNovo.ViewModels"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AgendaNovo"
        d:DataContext="{d:DesignInstance Type=vm:ClienteCriancaViewModel}"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:hc="https://handyorg.github.io/handycontrol" xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls" x:Class="AgendaNovo.GerenciarClientes"
        mc:Ignorable="d"
        WindowState="Maximized" MinWidth="600" MinHeight="900"
        Title="GerenciarClientes">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="480"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.Background>
            <LinearGradientBrush>
                <GradientStop Color="#7be9f6" Offset="0.1"/>
                <GradientStop Color="#f093da" Offset="1"/>
            </LinearGradientBrush>
        </Grid.Background>

        <!-- Pesquisa -->
        <TextBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="1"
                 Margin="20,10" Height="40" BorderBrush="Black" 
                 hc:InfoElement.Placeholder="Pesquisar por nome ou telefone"
                 Text="{Binding PesquisaText, UpdateSourceTrigger=PropertyChanged}" />
        <materialDesign:PackIcon Grid.Row="0" Grid.Column="1"
                                 Kind="Search" Width="40" Height="40"
                                 HorizontalAlignment="Right" Margin="0,10,20,0"/>

        <!-- Formulário -->
        <StackPanel Grid.Row="1" Grid.Column="0"
                    Orientation="Vertical" Margin="20,10">
            <!-- ID -->
            <hc:TextBox x:Name="txtId"
                        IsReadOnly="True"
                        HorizontalAlignment="Left"
                        hc:InfoElement.Placeholder="ID"
                        Text="{Binding NovoCliente.Id}"
                        Width="80" Height="30"
                        BorderBrush="Black" 
                        Margin="0,0,0,8"/>

            <!-- Cliente -->
            <hc:TextBox x:Name="txtCliente"
                        HorizontalAlignment="Left"
                        BorderBrush="Black" 
                        hc:InfoElement.Placeholder="Cliente"
                        Text="{Binding NovoCliente.Nome, Mode=TwoWay}"
                        PreviewTextInput="txtCliente_PreviewTextInput"
                        Width="435" Height="40"
                        Margin="0,0,0,8"/>

            <!-- Telefone + E-mail -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <hc:TextBox x:Name="txtTel"
                            BorderBrush="Black" 
                            hc:InfoElement.Placeholder="Telefone"
                            Text="{Binding NovoCliente.Telefone, Mode=TwoWay}"
                            LostFocus="txtTel_LostFocus"
                            Width="170" Height="40"
                            Margin="0,0,8,0"/>
                <hc:TextBox x:Name="txtEmail"
                            hc:InfoElement.Placeholder="Email"
                            BorderBrush="Black" 
                            LostFocus="txtEmail_LostFocus"
                            Text="{Binding NovoCliente.Email, Mode=TwoWay}"
                            Width="260" Height="40"/>
            </StackPanel>

            <!-- Criança, Gênero, Idade + Unidade -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <hc:ComboBox x:Name="txtCrianca"
                             BorderBrush="Black" 
                             IsEditable="True"
                             hc:InfoElement.Placeholder="Criança"
                             ItemsSource="{Binding ListaCriancasDoCliente}"
                             DisplayMemberPath="Nome"
                             Text="{Binding CriancaSelecionada.Nome, Mode=TwoWay}"
                             Width="180" Height="40"
                             Margin="0,0,8,0"/>
                <ComboBox Width="70" Height="40"
                          BorderBrush="Black" 
                          hc:InfoElement.Placeholder="Gênero"
                          ItemsSource="{Binding GenerosLista}"
                          SelectedItem="{Binding CriancaSelecionada.Genero}"
                          Margin="0,0,8,0"/>
                <hc:TextBox Width="65" Height="40"
                            BorderBrush="Black" 
                            hc:InfoElement.Placeholder="Idade"
                            Text="{Binding CriancaSelecionada.Idade}"
                            Margin="0,0,8,0"/>
                <ComboBox Width="100" Height="40"
                          BorderBrush="Black" 
                          ItemsSource="{Binding IdadesUnidadeDisponiveis}"
                          SelectedItem="{Binding CriancaSelecionada.IdadeUnidade}"/>
            </StackPanel>

            <!-- Aviso -->
            <TextBlock Text="⚠️ Cliente já existente detectado. Nova criança será adicionada."
                       Foreground="Orange" FontWeight="Bold" FontSize="12"
                       Visibility="{Binding ClienteExistenteDetectado,
                                    Converter={StaticResource BoolToVisibilityConverter}}"
                       Margin="0,0,0,8"/>

            <!-- Botões -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button Content="Salvar"
                        Background="#FF37FF00"
                        Command="{Binding SalvarClienteCriancaCommand}"
                        Width="100" Height="40"
                        BorderBrush="Black" 
                        hc:BorderElement.CornerRadius="10"
                        Margin="0,0,30,0"/>
                <Button Content="Editar"
                        Command="{Binding EditarClienteCriancaSelecionadoCommand}"
                        Width="100" Height="40"
                        BorderBrush="Black" 
                        hc:BorderElement.CornerRadius="10"
                        Background="Blue" Foreground="White" 
                        Margin="0,0,40,0"/>
                <Button Content="Excluir"
                        Command="{Binding ExcluirClienteOuCriancaSelecionadoCommand}"
                        Width="100" Height="40"
                        BorderBrush="Black" 
                        Background="Red"
                        Margin="0,0,40,0"
                        hc:BorderElement.CornerRadius="10"/>
            </StackPanel>
        </StackPanel>

        <!-- DataGrid -->
        <DataGrid Grid.Row="1" Grid.Column="1" Height="750"
                  ItemsSource="{Binding ListaClienteCrianca}"
                  SelectedItem="{Binding ClienteCriancaSelecionado}"
                  AutoGenerateColumns="False"
                  Margin="10">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding ClienteId}"/>
                <DataGridTextColumn Header="Cliente" Binding="{Binding NomeCliente}"/>
                <DataGridTextColumn Header="Telefone" Binding="{Binding Telefone}"/>
                <DataGridTextColumn Header="Email" Binding="{Binding Email}"/>
                <DataGridTextColumn Header="Criança" Binding="{Binding NomeCrianca}"/>
                <DataGridTextColumn Header="Idade" Binding="{Binding IdadeFormatada}"/>
                <DataGridTextColumn Header="Gênero" Binding="{Binding Genero}"/>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Window>
